# medbof - 400
Okay, looks like things are getting a bit more interesting. We have to give it a return address now.

# Prompt

![alt text](https://github.com/Jhayes97/MCCC2017-Walkthrough/blob/master/src/medb1.PNG "medbof")


# Guide
This challenge is exactly similar to the previous BO challenge, but this time we have to give the return address of the `do_system()` function instead of defaulting to it.
Looking at the source we once again see the `gets()`, which'll be another easy win for us.


First let's download the binary provided and extract the memory address of `do_system()`.


# readelf -s 

This command is part of the pwntools suite, it is very similar to `objdump -d `, with a few differences I'll let you google yourself.

We're only interested in `do_system()`, so let's grep for that.

![alt text](https://github.com/Jhayes97/MCCC2017-Walkthrough/blob/master/src/medb2.PNG "medbof")

We also need to turn the memory address into little-endian format for the binary to read it correctly, so we use pwntools' p32() function.

# pwn cyclic && dmesg

How do you find the exact buffer size? You can either guess around the amount of the buffer provided, or you can use tools like ltrace,strace, and dmesg.

![alt text](https://github.com/Jhayes97/MCCC2017-Walkthrough/blob/master/src/meb3.PNG "medbof")

After causing the binary to segfault, we can now run dmesg to troubleshoot how far into memory we wrote in with pwn cyclic.


![alt text](https://github.com/Jhayes97/MCCC2017-Walkthrough/blob/master/src/medb4.PNG "medbof")


This image is the result of running dmesg

You can see in the blue emphasized area : `616161616b` , or for the savvy person, `aaaak` translated from base16(hex) to base 256(ascii) . Counting back from our pwn cyclic string, that happens exactly  40 bytes in. We now know we must overwrite the buffer 40 bytes, and pass in our preferred memory return address.

# Putting it all together

Now let's put this all into action.

![alt text](https://github.com/Jhayes97/MCCC2017-Walkthrough/blob/master/src/medb5.PNG "medbof")


In the image you see we put our payload into `exploit.bin`, and pipe it into the server. The extra `;cat` after our payload is a trick to keep stdin open after we deliver our payload, allowing us to hold a shell.

We then run `ls` to check out our environment, and `cat flag.txt` to finish the challenge.


**flag{getting_better_at_hacking_binaries_i_see...}**







